app-id: io.github.victoralvesf.aonsoku
runtime: org.freedesktop.Platform
runtime-version: '25.08'
sdk: org.freedesktop.Sdk
base: org.electronjs.Electron2.BaseApp
base-version: '25.08'
command: aonsoku.sh
separate-locales: false
finish-args:
  - --share=ipc
  - --device=dri
  - --socket=wayland
  - --socket=fallback-x11
  - --socket=pulseaudio
  - --share=network
  - --env=ELECTRON_TRASH=gio
  - --env=XCURSOR_PATH=/run/host/user-share/icons:/run/host/share/icons
  - --talk-name=org.kde.StatusNotifierWatcher
  - --filesystem=xdg-run/tray-icon:create
  - --talk-name=com.canonical.AppIndicator
  # media player controls
  - --own-name=org.mpris.MediaPlayer2.chromium.*
  # discord rich presence
  - --filesystem=xdg-run/app/com.discordapp.Discord:create
modules:
  - name: aonsoku
    only-arches: ["x86_64"]
    skip-arches: ["aarch64"]
    buildsystem: simple
    build-commands:
      - chmod +x Aonsoku-*.AppImage
      - ./Aonsoku-*.AppImage --appimage-extract
      - mv squashfs-root /app/bin/aonsoku
      - install -Dm755 -t /app/bin/ aonsoku.sh
      - install -Dm644 flatpak/${FLATPAK_ID}.desktop      /app/share/applications/${FLATPAK_ID}.desktop
      - install -Dm644 flatpak/${FLATPAK_ID}.metainfo.xml /app/share/metainfo/${FLATPAK_ID}.metainfo.xml
      - install -Dm644 resources/icons/icon.png     /app/share/icons/hicolor/128x128/apps/${FLATPAK_ID}.png
    sources:
      - type: file
        url: https://github.com/victoralvesf/aonsoku/releases/download/v0.11.0/Aonsoku-v0.11.0-linux-x86_64.AppImage
        sha256: e0b8ab559e40eacfa0a9a6a267618141a7ad3bf81375c00c6a503f5967d409ab
      - type: git
        url: https://github.com/victoralvesf/aonsoku.git
        commit: 3ee88828183228fd7f75d7730db94ea14f340ef1
      - type: script
        dest-filename: aonsoku.sh
        commands:
          - for i in {0..9}; do
          - test -S $XDG_RUNTIME_DIR/discord-ipc-$i || ln -sf {app/com.discordapp.Discord,$XDG_RUNTIME_DIR}/discord-ipc-$i;
          - done
          - zypak-wrapper /app/bin/aonsoku/aonsoku "$@"
